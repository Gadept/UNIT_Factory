/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   newton.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: pkolomiy <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2017/03/04 14:56:32 by pkolomiy          #+#    #+#             */
/*   Updated: 2017/03/04 17:03:00 by pkolomiy         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "h.h"

static void	add(t_v *v, int n)
{
	if (!n)
	{
		!v->v ? v->v = (double*)malloc(sizeof(double) * 6) : 0;
		v->v[2] = 0;
	}
	(n == 1) && ((C < 4000000) || (C > 0) || (v->x < 999) || (v->x > 0)) ?
		(v->put[C] = (((int)v->v[2]) % 255 * (int)v->v[2]) + v->f[0]) : 0;
	(n == 1) && ((C < 4000000) || (C > 0) || (v->x < 999) || (v->x > 0)) ?
		(v->put[C + 1] = (((int)v->v[2]) % 255 * (int)v->v[2]) + v->f[1]) : 0;
	(n == 1) && ((C < 4000000) || (C > 0) || (v->x < 999) || (v->x > 0)) ?
		(v->put[C + 2] = (((int)v->v[2]) % 255 * (int)v->v[2]) + v->f[2]) : 0;
	(n == 2) && ((C < 4000000) || (C > 0) || (v->x < 999) || (v->x > 0)) ?
		(v->put[C] = 0) : 0;
	(n == 2) && ((C < 4000000) || (C > 0) || (v->x < 999) || (v->x > 0)) ?
		(v->put[C + 1] = 0) : 0;
	(n == 2) && ((C < 4000000) || (C > 0) || (v->x < 999) || (v->x > 0)) ?
		(v->put[C + 2] = 0) : 0;
}

void		count(t_v *v)
{
	v->v[3] = v->v[0];
	v->v[4] = v->v[1];
	v->v[5] = (v->v[0] * v->v[0] + v->v[1] * v->v[1]) *
		(v->v[0] * v->v[0] + v->v[1] * v->v[1]);
	v->v[0] = (2 * v->v[0] * v->v[5] + v->v[0] * v->v[0] -
			v->v[1] * v->v[1]) / (3.0 * v->v[5]);
	v->v[1] = (2 * v->v[1] * (v->v[5] - v->v[3])) / (3.0 * v->v[5]);
	v->v[5] = (v->v[0] - v->v[3]) * (v->v[0] - v->v[3]) +
		(v->v[1] - v->v[4]) * (v->v[1] - v->v[4]);
}

static void	make(t_v *v)
{
	v->y = 0;
	while (v->y < 1000)
	{
		v->x = 0;
		while (v->x < 1000)
		{
			add(v, 0);
			v->v[0] = (v->x - 500) / (v->z * 1000) + v->m1;
			v->v[1] = (v->y - 500) / (v->z * 1000) + v->m2;
			while (v->v[2] < v->i)
			{
				count(v);
				if (v->v[5] < 0.000001)
					break ;
				v->v[2]++;
			}
			(v->v[2] < v->i) ? add(v, 1) : add(v, 2);
			v->x++;
		}
		v->y++;
	}
}

void		newton(t_v *v, int n)
{
	v->img = mlx_new_image(v->mlx, 1000, 1000);
	v->put = mlx_get_data_addr(v->img, &v->a, &v->b, &v->c);
	(n == 1 || n == 10) ? (v->z = v->z * 1.1) : 0;
	(n == 2 || n == 11) ? (v->z = v->z * 0.9) : 0;
	(n == 3) ? (v->m1 = v->m1 + (0.3 / v->z)) : 0;
	(n == 4) ? (v->m1 = v->m1 - (0.3 / v->z)) : 0;
	(n == 5) ? (v->m2 = v->m2 - (0.3 / v->z)) : 0;
	(n == 6) ? (v->m2 = v->m2 + (0.3 / v->z)) : 0;
	(n == 7) ? (v->i = v->i + 1) : 0;
	(n == 8) ? (v->i = v->i - 1) : 0;
	(n == 9) ? (v->z = 0.3) : 0;
	(n == 9) ? (v->m1 = 0) : 0;
	(n == 9) ? (v->m2 = 0) : 0;
	(n == 10) ? (v->m1 = v->m1 + (v->x / 10000) / v->z) : 0;
	(n == 10) ? (v->m2 = v->m2 + (v->y / 10000) / v->z) : 0;
	(n == 11) ? (v->m1 = v->m1 - (v->x / 10000) / v->z) : 0;
	(n == 11) ? (v->m2 = v->m2 - (v->y / 10000) / v->z) : 0;
	(n >= 13) ? color(v, n) : 0;
	make(v);
	mlx_put_image_to_window(v->mlx, v->win, v->img, 0, 0);
	mlx_destroy_image(v->mlx, v->img);
}
